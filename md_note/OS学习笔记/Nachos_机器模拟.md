# Nachos机器模拟

### 一、概述

#### 1.1 Machine类

​        Machine类使用来模拟计算机主机的。它的功能有：读写寄存器、读写主存、运行一条用户程序的汇编指令、运行用户程序、单步调试用户程序、显示主存和寄存器状态、将虚拟内存地址转换为物理内存地址、陷入 Nachos 内核等等。 

​        Machine 类实现方法是在宿主机上分配两块内存分别作为虚拟机的寄存器和物理内存。

​        运行 用户程序时，先将用户程序从 Nachos 文件系统中读出，写入模拟的物理内存中，然后调用指令模拟模块对每一条用户指令解释执行。将用户程序的读写内存要求，转变为对物理内存地址的读写。Machine 类提供了单步调试用户程序的功能，执行一条指令后会自动停下来， 让用户查看系统状态，不过这里的单步调试是汇编指令级的。

#### 1.2 Interrupt类

​        Interrupt 类用来模拟硬件中断系统。在这个中断系统中，中断状态有开，关两种，中断类型 有时钟中断、磁盘中断、控制台写中断、控制台读中断、网络发送中断以及网络接收中断。 机器状态有用户态，核心态和空闲态。

​        在 Interrupt 类中有一个记录即将发生中断的队列，称为中断等待队列。中断等待队列中每个 等待处理的中断包含中断类型、中断处理程序的地址及参数、中断应当发生的时间等信息。 一般是由硬件设备模拟程序把将要发生的中断放入中断队列。中断系统提供了一个模拟机器时钟，机器时钟在下列情况下前进：1.用户程序打开中断 ；2.执行一条用户指令 ；3.处理机没有进程正在运行 。
