# Nachos用户程序和虚拟内存 

### 一、Nachos 对内存、寄存器以及CPU的模拟 

​        Nachos 寄存器组模拟了全部 32 个 MIPS 机（R2/3000）的寄存器，同时加上有关 Nachos 系统调试用的 8 个寄存器，以期让模 拟更加真实化并易于调试，对于一些特殊的寄存器说明如下： 

![特殊寄存器说明](statics\4-1.png)

​        Nachos 用宿主机的一块内存模拟自己的内存。**每个内存页的大小同磁盘扇 区的大小相同，而整个内存的大小远远小于模拟磁盘的大小。**事实上，Nachos 的内存只有当需要执行用户程序时用户程序的一个暂存地，**而作为操作系统内部使用的数据结构不存放在 Nachos 的模拟内存中**，而是申请 Nachos 所在宿主机的内存。所以 Nachos 的一些重要的数 据结构如线程控制结构等的数目可以是无限的，不受 Nachos 模拟内存大小的限制。 

​        这里需要强调的是，此处 Nachos 模拟的寄存器组同 Thread 类中的 machineState[]数组表示的寄存器组不同，后者代表的是宿主机的寄存器组，是实际存在的； 而前者只是为了运行拥护程序模拟的。 

​        在用户程序运行过程中，会有很多系统陷入核心的情况。系统陷入有两大类原因：**进行系统调用陷入和系统出错陷入**。系统调用陷入在用户程序进行系统调用时发生。系统调用可以看作是软件指令，它们有效地弥补了机器硬件指令不足；系统出错陷入在系统发生错误时发生， 比如用户程序使用了非法指令以及用户程序逻辑地址同实际的物理地址映射出错等情况。不同的出错陷入会有不同的处理，比如用户程序逻辑地址映射出错会引起页面的重新调入，而 用户程序使用了非法指令则需要向用户报告等等。Nachos 处理的陷入有： 





















